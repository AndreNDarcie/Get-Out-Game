<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Teste</title>
  </head>
  <body>
    <canvas width="500" height="500" style="background-color: black;"></canvas>
    <p>W, A, S, D to move.</p>
    <p>Player position: <span id="status">s</span></p>
  </body>
  <script src='object.js'></script>
  <script>
    var canvas = document.querySelector('canvas');
    var ctx = canvas.getContext("2d");
    var x = 0, y = 0;
    var cw=canvas.width;
    var ch=canvas.height;
    var objectList = [];

    var player = new Object({
      x: 0,
      y: 0,
      width: 20,
      height: 20
    });
    objectList.push(player);

    var npc = new Object({
      x: 60,
      y: 60,
      width: 20,
      height: 20
    });
    objectList.push(npc);

    console.log(objectList);

    ctx.fillStyle = "#FF0000";
    ctx.fillRect(0,0,150,75);

    function update(){

      ctx.clearRect(0,0,cw,ch);

      objectList.forEach(function (obj) {
        ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
      });

      document.getElementById('status').innerHTML = "[x: " + player.x + ", y: " + player.y + "]";
    }

    update(20,20);

    // listen for keydown events on the document
    document.addEventListener("keydown",handleKeydown,false);

    function handleKeydown(e){
      let moveRight, moveLeft, moveUp, moveDown;

      objectList.forEach(function (obj) {
        //if ((player.x + player.width) === obj.x && player.y === obj.y) { moveRight = false } else { moveRight = true }
        moveRight = !((player.x + player.width) === obj.x && player.y === obj.y);
        moveLeft = !(player.x === (obj.x + obj.width) && player.y === obj.y);
        moveUp = !(player.y === (obj.y + obj.height) && player.x === obj.x);
        moveDown = !((player.y + player.height) === obj.y && player.x === obj.x);
      });

      let x = player.x, y = player.y;
      switch(e.keyCode){
        case 87: if(moveUp && y > 0) y-=20; break;  // W
        case 65: if(moveLeft && x > 0) x-=20; break;  // A
        case 83: if(moveDown && y < (ch - 20)) y+=20; break;  // S
        case 68: if(moveRight && x < (cw - 20)) x+=20; break;  // D
      }
      player.x = x;
      player.y = y;
      update();
    }

  </script>
</html>
