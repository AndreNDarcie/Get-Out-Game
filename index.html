<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Teste</title>
  </head>
  <body style="background-color: #27ae60; font-family: Arial, Helvetica, sans-serif; color: #ecf0f1; text-align:center;">
    <h1>Dungeon Crawler</h1>
    <canvas width="500" height="500" style="background-color: #2ecc71;"></canvas>
    <p>W, A, S, D to move.</p>
    <p>Player position: <span id="status">s</span></p>
  </body>
  <script src='object.js'></script>
  <script>
    var canvas = document.querySelector('canvas');
    var ctx = canvas.getContext("2d");
    var x = 0, y = 0;
    var cw=canvas.width;
    var ch=canvas.height;
    var objectList = [];

    var player = new Object({
      type: 'player',
      x: 0,
      y: 0,
      width: 20,
      height: 20,
      color: "#34495e"
    });
    objectList.push(player);

    var npc = new Object({
      type: 'npc',
      x: 60,
      y: 60,
      width: 20,
      height: 20,
      color: "#9b59b6"
    });
    objectList.push(npc);

    var wall = new Object({
      type: 'wall',
      x: 100,
      y: 100,
      width: 20,
      height: 20,
      color: "#95a5a6"
    });
    objectList.push(wall);

    console.log(objectList);



    function update(){

      ctx.clearRect(0,0,cw,ch);

      objectList.forEach(function (obj) {
        ctx.fillStyle = obj.color;
        ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
      });

      document.getElementById('status').innerHTML = "[x: " + player.x + ", y: " + player.y + "]";
    }

    update(20,20);

    // listen for keydown events on the document
    document.addEventListener("keydown",handleKeydown,false);

    function handleKeydown(e){
      let moveRight, moveLeft, moveUp, moveDown;
      let canMove = true;

      objectList.forEach(function (obj) {
        //if ((player.x + player.width) === obj.x && player.y === obj.y) { moveRight = false } else { moveRight = true }
        //if (obj.type === "player") { return; }

        if (canMove){
          moveRight = !((player.x + player.width) === obj.x && player.y === obj.y);
          moveLeft = !(player.x === (obj.x + obj.width) && player.y === obj.y);
          moveUp = !(player.y === (obj.y + obj.height) && player.x === obj.x);
          moveDown = !((player.y + player.height) === obj.y && player.x === obj.x);
        }

        canMove = moveUp && moveDown && moveLeft && moveRight;

        canMove ? console.log("pode mover " + obj.type) : console.log("nao pode mover "  + obj.type);

      });

      let x = player.x, y = player.y;
      switch(e.keyCode){
        case 87: if(moveUp && y > 0) y-=20; break;  // W
        case 65: if(moveLeft && x > 0) x-=20; break;  // A
        case 83: if(moveDown && y < (ch - 20)) y+=20; break;  // S
        case 68: if(moveRight && x < (cw - 20)) x+=20; break;  // D
      }
      player.x = x;
      player.y = y;
      update();
    }

  </script>
</html>
